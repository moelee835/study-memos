# Database Partitioning, Sharding, Reflication

## 1. Partitioning
파티셔닝은 DB의 단일 테이블을 분할하는 기법을 의미한다.
파티셔닝은 2가지 종류가 있다.

1. Vertical Paritioning
수직 파티셔닝은 컬럼 기준으로 테이블을 분할한다. 특정 컬럼들을 모아 다른 테이블을 형성하며 외래키를 통해 연결된다.
예를들어 게시판 조회 기능을 구현할 때, 테이블에서 게시판 정보 + 게시글 내용이 한 테이블에 있을 수 있다.
애플리케이션이 비록 select 문에서 게시글 내용을 선택하지 않는다고 해도, 일단 IO 연산을 통해 모든 내용을 읽어와야만 한다.
이러한 비용은 체감되지 않더라도 장기적으로 영향이 있기 때문에 게시글처럼 한번에 조회되지 않고 큰 컬럼을 분리해 IO 비용을 낮출 수 있다.
또한, 보안상 민감한 정보를 묶거나 특히 자주 조회되는 컬럼들을 별도의 테이블로 만드는 것 또한 가능하다.
DB 정규화 또한 수직 파티셔닝의 일종이다.

2. Horizontal Partitioning
수평 파티셔닝은 행을 기준으로 테이블을 분할한다. 이때, 분할된 두 테이블은 겹치는 데이터가 저장되어선 안된다. 이 기준을 나눠주는 것을 파티션 키 라고 한다.
파티션 키는 보통 PK가 사용된다.
테이블 배정은 해시 함수나 범위를 활용할 수 있다.

만약 어떤 컬럼을 검색하고자 할 때, 이 조건이 파티션 키에 해당한다면, 파티션 키를 이용해 특정 테이블로 접근한다.
만약 아니라면, 모든 테이블에 대한 조회가 필요하다.
파티셔닝은 각 테이블에 균등하게 데이터가 분리되도록 기준을 잘 정하는게 중요하다.

hash based partitioning은 테이블을 추가하는 것이 까다롭다. 기존 테이블들에 존재하는 데이터들이 새로운 테이블로 들어가야 할 수 있기 때문이다. 따라서 초반 설계시 몇 개의 테이블을 생성해야할지를 잘 산정해야 한다.

## 2. Sharding
샤딩은 수평 파티셔닝과 같이 테이블을 여럿 수평적으로 분할하지만, Partitioning이 하나의 서버 내에서 수행되는 것과 달리 샤딩은 여러개의 서버로 분할된 테이블을 나눠 관리한다.
기존 Partitioning은 개별 테이블에 대한 조회 비용은 감소했지만, 서버에 들어오는 트래픽이 많아지면 그만큼 부하가 늘어나게 된다. 반면 샤딩은 서로 다른 서버를 사용하기 때문에 부하가 분산되어 더 빠른 응답이 가능해진다.
> 즉, 샤딩의 목적은 부하의 분산이다.

샤딩의 테이블 분할 기준은 샤딩 키가 된다.
그리고 각 파티션들을 Shard라고 부른다.

## 3. Replication
레플리케이션은 샤딩과 달리 다른 DB를 복제한 DB를 운영하는 것이다. 단일 DB 서버의 경우 장애 발생시 서비스가 중단되게 된다. 이를 대비하기 위해 DB 서버 여러개를 만들어 원래 DB 서버의 데이터를 카피하도록 한다.
이때 카피는 원본 DB에서 발생한 모든 갱신 연산을 포함한다. 원본 DB에서 특정 데이터가 삽입 또는 삭제된다면, 이 변경들이 레플리케이션에도 반영되어야 한다.

**즉 '동기화'가 중요하다.** 동기화 기법에 대해 공부할 필요가 있다.

원본 DB는 Master / Primary / Leader 라고 부른다.
복사 DB는 Slave / Secondary / Replica 라고 부른다.

만약 원본 서버에 문제가 발생했을 때, 백엔드 서버가 Fail over를 하여 복사 DB 서버로 접근하도록하여 HA(High Availability)를 보장할 수 있다.
특히 레플리케이션을 활용하면, 한 쪽으로 몰리는 Read 연산 요청을 다른 복사 DB로도 보낼 수가 있어 트래픽을 분산시켜 처리할 수 있는 이점도 있다.